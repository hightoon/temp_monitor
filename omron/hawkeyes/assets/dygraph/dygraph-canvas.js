DygraphCanvasRenderer=function(a,d,b,e){this.dygraph_=a;this.layout=e;this.element=d;this.elementContext=b;this.container=this.element.parentNode;this.height=this.element.height;this.width=this.element.width;if(!this.isIE&&!DygraphCanvasRenderer.isSupported(this.element))throw"Canvas is not supported.";this.xlabels=[];this.ylabels=[];this.annotations=[];this.chartLabels={};this.area=this.computeArea_();this.container.style.position="relative";this.container.style.width=this.width+"px";a=this.dygraph_.canvas_ctx_;
a.beginPath();a.rect(this.area.x,this.area.y,this.area.w,this.area.h);a.clip();a=this.dygraph_.hidden_ctx_;a.beginPath();a.rect(this.area.x,this.area.y,this.area.w,this.area.h);a.clip()};DygraphCanvasRenderer.prototype.attr_=function(a){return this.dygraph_.attr_(a)};
DygraphCanvasRenderer.prototype.computeArea_=function(){var a={x:0,y:0};this.attr_("drawYAxis")&&(a.x=this.attr_("yAxisLabelWidth")+2*this.attr_("axisTickSize"));a.w=this.width-a.x-this.attr_("rightGap");a.h=this.height;this.attr_("drawXAxis")&&(this.attr_("xAxisHeight")?a.h-=this.attr_("xAxisHeight"):a.h-=this.attr_("axisLabelFontSize")+2*this.attr_("axisTickSize"));2==this.dygraph_.numAxes()?a.w-=this.attr_("yAxisLabelWidth")+2*this.attr_("axisTickSize"):2<this.dygraph_.numAxes()&&this.dygraph_.error("Only two y-axes are supported at this time. (Trying to use "+
this.dygraph_.numAxes()+")");this.attr_("title")&&(a.h-=this.attr_("titleHeight"),a.y+=this.attr_("titleHeight"));this.attr_("xlabel")&&(a.h-=this.attr_("xLabelHeight"));this.attr_("ylabel");return a};
DygraphCanvasRenderer.prototype.clear=function(){if(this.isIE)try{this.clearDelay&&(this.clearDelay.cancel(),this.clearDelay=null);var a=this.elementContext}catch(d){this.clearDelay=MochiKit.Async.wait(this.IEDelay);this.clearDelay.addCallback(bind(this.clear,this));return}a=this.elementContext;a.clearRect(0,0,this.width,this.height);for(a=0;a<this.xlabels.length;a++){var b=this.xlabels[a];b.parentNode&&b.parentNode.removeChild(b)}for(a=0;a<this.ylabels.length;a++)b=this.ylabels[a],b.parentNode&&
b.parentNode.removeChild(b);for(a=0;a<this.annotations.length;a++)b=this.annotations[a],b.parentNode&&b.parentNode.removeChild(b);for(var e in this.chartLabels)this.chartLabels.hasOwnProperty(e)&&(b=this.chartLabels[e],b.parentNode&&b.parentNode.removeChild(b));this.xlabels=[];this.ylabels=[];this.annotations=[];this.chartLabels={}};
DygraphCanvasRenderer.isSupported=function(a){var d=null;try{d="undefined"==typeof a||null==a?document.createElement("canvas"):a,d.getContext("2d")}catch(b){if(a=navigator.appVersion.match(/MSIE (\d\.\d)/),d=-1!=navigator.userAgent.toLowerCase().indexOf("opera"),!a||6>a[1]||d)return!1}return!0};DygraphCanvasRenderer.prototype.setColors=function(a){this.colorScheme_=a};
DygraphCanvasRenderer.prototype.render=function(){var a=this.elementContext;this.attr_("underlayCallback")&&this.attr_("underlayCallback")(a,this.area,this.dygraph_,this.dygraph_);if(this.attr_("drawYGrid")){var d=this.layout.yticks;a.save();a.strokeStyle=this.attr_("gridLineColor");a.lineWidth=this.attr_("gridLineWidth");for(var b=0;b<d.length;b++)if(0==d[b][0]){var e=Math.round(this.area.x)+.5,h=Math.round(this.area.y+d[b][1]*this.area.h)-.5;a.beginPath();a.moveTo(e,h);a.lineTo(e+this.area.w,h);
a.closePath();a.stroke()}}if(this.attr_("drawXGrid"))for(d=this.layout.xticks,a.save(),a.strokeStyle=this.attr_("gridLineColor"),a.lineWidth=this.attr_("gridLineWidth"),b=0;b<d.length;b++)e=Math.round(this.area.x+d[b][0]*this.area.w)+.5,h=Math.round(this.area.y+this.area.h)-.5,a.beginPath(),a.moveTo(e,h),a.lineTo(e,this.area.y),a.closePath(),a.stroke();this._renderLineChart();this._renderAxis();this._renderChartLabels();this._renderAnnotations()};
DygraphCanvasRenderer.prototype._renderAxis=function(){function a(a){return Math.round(a)+.5}function d(a){return Math.round(a)-.5}if(this.attr_("drawXAxis")||this.attr_("drawYAxis")){var b=this.elementContext,e={position:"absolute",fontSize:this.attr_("axisLabelFontSize")+"px",zIndex:10,color:this.attr_("axisLabelColor"),width:this.attr_("axisLabelWidth")+"px",overflow:"hidden"},h=function(a,b){var c=document.createElement("div"),d;for(d in e)e.hasOwnProperty(d)&&(c.style[d]=e[d]);d=document.createElement("div");
d.className="dygraph-axis-label dygraph-axis-label-"+b;d.appendChild(document.createTextNode(a));c.appendChild(d);return c};b.save();b.strokeStyle=this.attr_("axisLineColor");b.lineWidth=this.attr_("axisLineWidth");if(this.attr_("drawYAxis")){if(this.layout.yticks&&0<this.layout.yticks.length){for(var k=0;k<this.layout.yticks.length;k++){var l=this.layout.yticks[k];if("function"==typeof l)return;var f=this.area.x,g=1;1==l[0]&&(f=this.area.x+this.area.w,g=-1);var c=this.area.y+l[1]*this.area.h;b.beginPath();
b.moveTo(a(f),d(c));b.lineTo(a(f-g*this.attr_("axisTickSize")),d(c));b.closePath();b.stroke();g=h(l[2],"y");f=c-this.attr_("axisLabelFontSize")/2;0>f&&(f=0);f+this.attr_("axisLabelFontSize")+3>this.height?g.style.bottom="0px":g.style.top=f+"px";0==l[0]?(g.style.left=this.area.x-this.attr_("yAxisLabelWidth")-this.attr_("axisTickSize")+"px",g.style.textAlign="right"):1==l[0]&&(g.style.left=this.area.x+this.area.w+this.attr_("axisTickSize")+"px",g.style.textAlign="left");g.style.width=this.attr_("yAxisLabelWidth")+
"px";this.container.appendChild(g);this.ylabels.push(g)}k=this.ylabels[0];l=this.attr_("axisLabelFontSize");parseInt(k.style.top)+l>this.height-l&&(k.style.top=parseInt(k.style.top)-l/2+"px")}b.beginPath();b.moveTo(a(this.area.x),d(this.area.y));b.lineTo(a(this.area.x),d(this.area.y+this.area.h));b.closePath();b.stroke();2==this.dygraph_.numAxes()&&(b.beginPath(),b.moveTo(d(this.area.x+this.area.w),d(this.area.y)),b.lineTo(d(this.area.x+this.area.w),d(this.area.y+this.area.h)),b.closePath(),b.stroke())}if(this.attr_("drawXAxis")){if(this.layout.xticks)for(k=
0;k<this.layout.xticks.length;k++){l=this.layout.xticks[k];if("function"==typeof dataset)return;f=this.area.x+l[0]*this.area.w;c=this.area.y+this.area.h;b.beginPath();b.moveTo(a(f),d(c));b.lineTo(a(f),d(c+this.attr_("axisTickSize")));b.closePath();b.stroke();g=h(l[1],"x");g.style.textAlign="center";g.style.top=c+this.attr_("axisTickSize")+"px";l=f-this.attr_("axisLabelWidth")/2;l+this.attr_("axisLabelWidth")>this.width&&(l=this.width-this.attr_("xAxisLabelWidth"),g.style.textAlign="right");0>l&&(l=
0,g.style.textAlign="left");g.style.left=l+"px";g.style.width=this.attr_("xAxisLabelWidth")+"px";this.container.appendChild(g);this.xlabels.push(g)}b.beginPath();b.moveTo(a(this.area.x),d(this.area.y+this.area.h));b.lineTo(a(this.area.x+this.area.w),d(this.area.y+this.area.h));b.closePath();b.stroke()}b.restore()}};
DygraphCanvasRenderer.prototype._renderChartLabels=function(){if(this.attr_("title")){var a=document.createElement("div");a.style.position="absolute";a.style.top="0px";a.style.left=this.area.x+"px";a.style.width=this.area.w+"px";a.style.height=this.attr_("titleHeight")+"px";a.style.textAlign="center";a.style.fontSize=this.attr_("titleHeight")-8+"px";a.style.fontWeight="bold";var d=document.createElement("div");d.className="dygraph-label dygraph-title";d.innerHTML=this.attr_("title");a.appendChild(d);
this.container.appendChild(a);this.chartLabels.title=a}this.attr_("xlabel")&&(a=document.createElement("div"),a.style.position="absolute",a.style.bottom=0,a.style.left=this.area.x+"px",a.style.width=this.area.w+"px",a.style.height=this.attr_("xLabelHeight")+"px",a.style.textAlign="center",a.style.fontSize=this.attr_("xLabelHeight")-2+"px",d=document.createElement("div"),d.className="dygraph-label dygraph-xlabel",d.innerHTML=this.attr_("xlabel"),a.appendChild(d),this.container.appendChild(a),this.chartLabels.xlabel=
a);if(this.attr_("ylabel")){var b=this.area.y,d=this.attr_("yLabelWidth"),e=this.area.h,a=document.createElement("div");a.style.position="absolute";a.style.left=0;a.style.top=b+"px";a.style.width=d+"px";a.style.height=e+"px";a.style.fontSize=this.attr_("yLabelWidth")-2+"px";b=document.createElement("div");b.style.position="absolute";b.style.width=e+"px";b.style.height=d+"px";b.style.top=e/2-d/2+"px";b.style.left=d/2-e/2+"px";b.style.textAlign="center";b.style.transform="rotate(-90deg)";b.style.WebkitTransform=
"rotate(-90deg)";b.style.MozTransform="rotate(-90deg)";b.style.OTransform="rotate(-90deg)";b.style.msTransform="rotate(-90deg)";"undefined"!==typeof document.documentMode&&9>document.documentMode&&(b.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation=3)",b.style.left="0px",b.style.top="0px");d=document.createElement("div");d.className="dygraph-label dygraph-ylabel";d.innerHTML=this.attr_("ylabel");b.appendChild(d);a.appendChild(b);this.container.appendChild(a);this.chartLabels.ylabel=
a}};
DygraphCanvasRenderer.prototype._renderAnnotations=function(){for(var a={position:"absolute",fontSize:this.attr_("axisLabelFontSize")+"px",zIndex:10,overflow:"hidden"},d=function(a,b,c,d){return function(f){var e=c.annotation;if(e.hasOwnProperty(a))e[a](e,c,d.dygraph_,f);else d.dygraph_.attr_(b)&&d.dygraph_.attr_(b)(e,c,d.dygraph_,f)}},b=this.layout.annotated_points,e=0;e<b.length;e++){var h=b[e];if(!(h.canvasx<this.area.x||h.canvasx>this.area.x+this.area.w)){var k=h.annotation,l=6;k.hasOwnProperty("tickHeight")&&(l=
k.tickHeight);var f=document.createElement("div"),g;for(g in a)a.hasOwnProperty(g)&&(f.style[g]=a[g]);k.hasOwnProperty("icon")||(f.className="dygraphDefaultAnnotation");k.hasOwnProperty("cssClass")&&(f.className+=" "+k.cssClass);var c=k.hasOwnProperty("width")?k.width:16,m=k.hasOwnProperty("height")?k.height:16;if(k.hasOwnProperty("icon")){var n=document.createElement("img");n.src=k.icon;n.width=c;n.height=m;f.appendChild(n)}else h.annotation.hasOwnProperty("shortText")&&f.appendChild(document.createTextNode(h.annotation.shortText));
f.style.left=h.canvasx-c/2+"px";f.style.top=k.attachAtBottom?this.area.h-m-l+"px":h.canvasy-m-l+"px";f.style.width=c+"px";f.style.height=m+"px";f.title=h.annotation.text;f.style.color=this.colors[h.name];f.style.borderColor=this.colors[h.name];k.div=f;Dygraph.addEvent(f,"click",d("clickHandler","annotationClickHandler",h,this));Dygraph.addEvent(f,"mouseover",d("mouseOverHandler","annotationMouseOverHandler",h,this));Dygraph.addEvent(f,"mouseout",d("mouseOutHandler","annotationMouseOutHandler",h,this));
Dygraph.addEvent(f,"dblclick",d("dblClickHandler","annotationDblClickHandler",h,this));this.container.appendChild(f);this.annotations.push(f);f=this.elementContext;f.strokeStyle=this.colors[h.name];f.beginPath();k.attachAtBottom?(f.moveTo(h.canvasx,this.area.h),f.lineTo(h.canvasx,this.area.h-2-l)):(f.moveTo(h.canvasx,h.canvasy),f.lineTo(h.canvasx,h.canvasy-2-l));f.closePath();f.stroke()}}};
DygraphCanvasRenderer.prototype._renderLineChart=function(){var a=this.elementContext,d=this.attr_("fillAlpha"),b=this.attr_("errorBars")||this.attr_("customBars"),e=this.attr_("fillGraph"),h=this.attr_("stackedGraph"),k=this.attr_("stepPlot"),l=[],f;for(f in this.layout.datasets)this.layout.datasets.hasOwnProperty(f)&&l.push(f);f=l.length;this.colors={};for(var g=0;g<f;g++)this.colors[l[g]]=this.colorScheme_[g%this.colorScheme_.length];for(g=0;g<this.layout.points.length;g++){var c=this.layout.points[g];
c.canvasx=this.area.w*c.x+this.area.x;c.canvasy=this.area.h*c.y+this.area.y}if(b)for(e&&this.dygraph_.warn("Can't use fillGraph option with error bars"),g=0;g<f;g++){var b=l[g],c=this.dygraph_.axisPropertiesForSeries(b),m=this.colors[b];a.save();var h=e=NaN,n=[-1,-1],r=c.yscale,c=new RGBColor(m),c="rgba("+c.r+","+c.g+","+c.b+","+d+")";a.fillStyle=c;a.beginPath();for(var p=0;p<this.layout.points.length;p++)c=this.layout.points[p],c.name==b&&(Dygraph.isOK(c.y)?(k?(m=[h-c.errorPlus*r,h+c.errorMinus*
r],h=c.y):m=[c.y-c.errorPlus*r,c.y+c.errorMinus*r],m[0]=this.area.h*m[0]+this.area.y,m[1]=this.area.h*m[1]+this.area.y,isNaN(e)||(k?a.moveTo(e,m[0]):a.moveTo(e,n[0]),a.lineTo(c.canvasx,m[0]),a.lineTo(c.canvasx,m[1]),k?a.lineTo(e,m[1]):a.lineTo(e,n[1]),a.closePath()),n=m,e=c.canvasx):e=NaN);a.fill()}else if(e)for(var s=[],g=f-1;0<=g;g--){var b=l[g],m=this.colors[b],c=this.dygraph_.axisPropertiesForSeries(b),q=1+c.minyval*c.yscale;0>q?q=0:1<q&&(q=1);q=this.area.h*q+this.area.y;a.save();e=NaN;n=[-1,
-1];r=c.yscale;c=new RGBColor(m);c="rgba("+c.r+","+c.g+","+c.b+","+d+")";a.fillStyle=c;a.beginPath();for(p=0;p<this.layout.points.length;p++)c=this.layout.points[p],c.name==b&&(Dygraph.isOK(c.y)?(h?(lastY=s[c.canvasx],void 0===lastY&&(lastY=q),s[c.canvasx]=c.canvasy,m=[c.canvasy,lastY]):m=[c.canvasy,q],isNaN(e)||(a.moveTo(e,n[0]),k?a.lineTo(c.canvasx,n[0]):a.lineTo(c.canvasx,m[0]),a.lineTo(c.canvasx,m[1]),a.lineTo(e,n[1]),a.closePath()),n=m,e=c.canvasx):e=NaN);a.fill()}d=function(a){return null===
a||isNaN(a)};for(g=0;g<f;g++)for(b=l[g],m=this.colors[b],n=this.dygraph_.attr_("strokeWidth",b),a.save(),c=this.layout.points[0],r=this.dygraph_.attr_("pointSize",b),h=e=null,s=this.dygraph_.attr_("drawPoints",b),q=this.layout.points,p=0;p<q.length;p++)if(c=q[p],c.name==b)if(d(c.canvasy))k&&null!=e&&(a.beginPath(),a.strokeStyle=m,a.lineWidth=this.attr_("strokeWidth"),a.moveTo(e,h),a.lineTo(c.canvasx,h),a.stroke()),e=h=null;else{var t=!e&&(p==q.length-1||d(q[p+1].canvasy));null===e?(e=c.canvasx,h=
c.canvasy):n&&(a.beginPath(),a.strokeStyle=m,a.lineWidth=n,a.moveTo(e,h),k&&a.lineTo(c.canvasx,h),e=c.canvasx,h=c.canvasy,a.lineTo(e,h),a.stroke());if(s||t)a.beginPath(),a.fillStyle=m,a.arc(c.canvasx,c.canvasy,r,0,2*Math.PI,!1),a.fill()}a.restore()};